; ***************************************************************************************************************
; ***************************************************************************************************************
;
;		File:		virtualio.asm
;		Purpose:	Input/Output routines.
;		Author:		Paul Robson (paul@robsons.org.uk)
;		Date:		14th January 2017.
;
; ***************************************************************************************************************
; ***************************************************************************************************************

; ***************************************************************************************************************
;
;	These routines will be entered with P = rUtilPC or P = rSubPC and should change no registers other than
; 	D and DF. On entry R2 will point to an empty stack space.
;
; ***************************************************************************************************************

; ***************************************************************************************************************
;
;												Get a keystroke into D.
;
; ***************************************************************************************************************

	return
XIOGetKey:
	sex 	r2 															; fix up after Mark.
	inp 	1 															; read keyboard port
	bz 		XIOGetKey 													; no key, keep trying
	inc 	r2 															; standard return.
	br 		XIOGetKey-1

; ***************************************************************************************************************
;
;										    Write a character to the display
;
; ***************************************************************************************************************

	return
XIOWriteCharacter:
	sex 	r2
	str 	r2
	out 	1
	dec 	r2
	inc 	r2
	br 		XIOWriteCharacter-1